audio = new QAudioRecorder(this);
audio->setAudioInput(audio->defaultAudioInput());

QAudioEncoderSettings audioSettings;
audioSettings.setCodec("audio/pcm");
audioSettings.setSampleRate(16000);
audioSettings.setChannelCount(1);
audioSettings.setBitRate(128000); // Лучше указать стандартный битрейт
audioSettings.setQuality(QMultimedia::HighQuality);

audio->setEncodingSettings(audioSettings);

// Установим имя выходного файла
audio->setOutputLocation(QUrl::fromLocalFile("output.wav"));

// Ждём, пока аудиозапись действительно начнётся
connect(audio, &QAudioRecorder::stateChanged, this, [this](QMediaRecorder::State state) {
    if (state == QMediaRecorder::RecordingState) {
        qDebug() << "Recording started, ready to speak!";
        // Можно включить UI-индикатор, начать отсчёт и т.д.
    }
});

// Старт с задержкой 100 мс для избежания щелчка
QTimer::singleShot(100, this, [this]() {
    audio->record();
});
